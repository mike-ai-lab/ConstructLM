<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOQ Interactive Mind Map</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* Depth of Sky Background */
            background: radial-gradient(circle at center, #2c3e50 0%, #000000 100%);
            color: white;
        }

        #tree-container {
            width: 100vw;
            height: 100vh;
        }

        .node circle {
            fill: #fff;
            stroke-width: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node text {
            font: 14px sans-serif;
            fill: #eee;
            text-shadow: 2px 2px 4px #000;
            pointer-events: none; /* Let clicks pass through text to the circle */
        }

        .link {
            fill: none;
            stroke: #555;
            stroke-width: 1.5px;
            opacity: 0.6;
        }

        /* Tooltip for help */
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #444;
            pointer-events: none;
        }
        .controls h3 { margin: 0 0 5px 0; font-size: 16px; color: #fff; }
        .controls p { margin: 0; font-size: 12px; color: #ccc; }

    </style>
</head>
<body>

<div class="controls">
    <h3>BOQ Project Map</h3>
    <p>• Click circles to Expand/Collapse</p>
    <p>• Drag to Pan</p>
    <p>• Scroll/Pinch to Zoom</p>
</div>

<div id="tree-container"></div>

<script>
    // --- 1. THE DATA (Transcribed from your image) ---
    const treeData = {
        "name": "BOQ Doors, Windows & Panjas",
        "children": [
            {
                "name": "Overall Project Summary",
                "children": [
                    { "name": "Total Items: 354" },
                    { "name": "BWB Items: 167" },
                    { "name": "KAL Items: 98" },
                    { "name": "Total Quantity: 1285" }
                ]
            },
            {
                "name": "BWB Door Types (Glazed & Metal)",
                "children": [
                    {
                        "name": "BWB Glazed Doors (Exterior)",
                        "children": [
                            {
                                "name": "Key Types & Properties",
                                "children": [
                                    {"name": "EXT-01 (2000x2100mm, 32 dB Acoustic)"},
                                    {"name": "EXT-02 (3000x2400mm, 32 dB Acoustic)"},
                                    {"name": "EXT-03/Acc (1000x2400mm, 60 min Fire, 40 dB Acoustic)"},
                                    {"name": "EXT-04 (1000x2400mm, WOOD)"}
                                ]
                            },
                            {
                                "name": "Location",
                                "children": [
                                    {"name": "ENTRANCE / OFFICE AREA"},
                                    {"name": "COURTYARD"},
                                    {"name": "TERRACE"},
                                    {"name": "CEO OFFICE"},
                                    {"name": "CIRCULATION"}
                                ]
                            },
                            {
                                "name": "Material Frame",
                                "children": [
                                    {"name": "GLASS/ALUMINUM/WOOD (Frame: ALUMINUM/WOOD)"},
                                    {"name": "WOOD (Frame: WOOD)"}
                                ]
                            }
                        ]
                    },
                    {
                        "name": "BWB Glazed Doors (Interior)",
                        "children": [
                            {"name": "INT-C (METAL/ALUMINUM, 1000x2200mm, 60 min Fire)"},
                            {"name": "INT-02 (METAL/ALUMINUM, 1000x2200mm, 60 min Fire)"},
                            {"name": "INT-03 (METAL/METAL, 1000x2200mm, 90 min Fire option)"},
                            {"name": "INT-04 (METAL/METAL, 1000x2200mm, 90 min Fire option)"}
                        ]
                    },
                    {
                        "name": "BWB Metal Doors (Interior)",
                        "children": [
                            {"name": "INT-01 (1200x2200mm, 60 min, 35 dB)"},
                            {"name": "INT-S-01 (2000x2100mm, up to 90 min Fire, 35 dB option)"},
                            {"name": "INT-S-02 (1500x2200mm, Flush, 35 dB)"},
                            {"name": "INT-01-V (900x2200mm, vent/louver option)"},
                            {"name": "INT-02 (1000x2200mm, up to 120 min, 35 dB option)"}
                        ]
                    }
                ]
            },
            {
                "name": "Windows and Openings",
                "children": [
                    {
                        "name": "BWB Aluminum Windows",
                        "children": [
                            {"name": "W-01 (700 x 1100mm)"},
                            {"name": "W-04 / WC (1100 x 500mm)"},
                            {"name": "W-03 (1600 x 2000mm)"},
                            {"name": "W-02 (1100 x 2000mm)"}
                        ]
                    },
                    {
                        "name": "BWB External Windows",
                        "children": [
                            {
                                "name": "Operability/Frame",
                                "children": [
                                    {"name": "Removable Fly mesh"},
                                    {"name": "With Wood Shutters (W)"}
                                ]
                            },
                            {
                                "name": "Types / Examples",
                                "children": [
                                    {"name": "A-A-W (2000 x 1000mm)"},
                                    {"name": "B-B-W (1000 x 2600mm)"},
                                    {"name": "C-C-1 / C-C-2 / V (Fixed/Vent/Low-E glass)"},
                                    {"name": "SF-1 to SF-5 (Fixed Window up to 5500mm width)"}
                                ]
                            }
                        ]
                    },
                    {
                        "name": "KAL External Windows",
                        "children": [
                            {"name": "Triangular/Circular Panja"},
                            {"name": "Types: EXT-O-1, EXT-O-2, EXT-O-3 (EXT-O-3 C 900mm dia)"}
                        ]
                    }
                ]
            },
            {
                "name": "Panjas and Interior Types",
                "children": [
                    {
                        "name": "BWB Frameless Glass Partition",
                        "children": [
                            {"name": "Type PG - P-G-1/2/3"},
                            {"name": "Description: Fixed floor glass partition with single leaf door"},
                            {"name": "Location: Service"},
                            {"name": "Dimension: Varied (e.g., 3750x2700mm)"}
                        ]
                    },
                    {
                        "name": "BWB Glazed Panja",
                        "children": [
                            {"name": "EXT-P-3 (Rectangular, 12 locations - Acoustic)"},
                            {"name": "EXT-P-4 / Mock / BWB-G-C (Triangular/Square shapes)"},
                            {"name": "EXT-P-1/2 (60 min rated steel triangles)"}
                        ]
                    },
                    {
                        "name": "KAL Opening Panjas (Exterior)",
                        "children": [
                            {"name": "EXT-KA-01 / KA-02 / KA-03 / OP-01 / OP-02 / OP-03"},
                            {"name": "Window Types: A-01, B-01/2/3, C-01, M-01, N-01, S-01"},
                            {"name": "Nature: With carved doors for Panja (e.g., C-01)"},
                            {"name": "Nature: With wood shutters (e.g., A-01/C-01/M-01)"}
                        ]
                    },
                    {
                        "name": "KAL Structural Panja",
                        "children": [
                            {"name": "EXT-SL-OP-01, OP-02, SL-DW-01, OP-03, OP-04"},
                            {"name": "Description: Structural glazing for irregular elements"}
                        ]
                    }
                ]
            },
            {
                "name": "Roller Shutters",
                "children": [
                    {
                        "name": "BWB Roller Shutters (Exterior)",
                        "children": [
                            {"name": "EXT-S1 (4000 x 3000mm, Security Control Motor, B2 Fire Ent)"},
                            {"name": "EXT-S2 (6000 x 3650mm, Security Control Motor, B2 Fire Ent)"}
                        ]
                    },
                    {
                        "name": "KAL Rolling Shutter",
                        "children": [
                            {"name": "Type S1 (2650 x 3300mm)"}
                        ]
                    }
                ]
            },
            {
                "name": "Common Specifications",
                "children": [
                    {
                        "name": "Location Types",
                        "children": [
                            {"name": "Interior"},
                            {"name": "Exterior"}
                        ]
                    },
                    {
                        "name": "Materials",
                        "children": [
                            {"name": "GLASS + ALUMINUM"},
                            {"name": "ALUMINUM"},
                            {"name": "GLASS + ALUMINUM + WOOD"}
                        ]
                    },
                    {
                        "name": "Performance Criteria",
                        "children": [
                            {"name": "Fire Rating (60 min, 90 min max)"},
                            {"name": "Acoustic bridging: 35dB, 45dB, 60dB ranges"}
                        ]
                    }
                ]
            }
        ]
    };

    // --- 2. SETUP D3 VISUALIZATION ---

    const margin = {top: 20, right: 90, bottom: 30, left: 90},
          width = window.innerWidth - margin.left - margin.right,
          height = window.innerHeight - margin.top - margin.bottom;

    // Create the SVG container with Zoom capability
    const svg = d3.select("#tree-container").append("svg")
        .attr("width", "100%")
        .attr("height", "100%")
        .call(d3.zoom().on("zoom", function (event) {
            g.attr("transform", event.transform);
        }))
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    const g = svg.append("g");

    let i = 0,
        duration = 750,
        root;

    // Declare a tree layout and assign the size
    const treeMap = d3.tree().nodeSize([30, 250]); // Height spacing, Width spacing

    // --- 3. COLOR LOGIC ---
    // Distinct colors for the main branches
    const colorScale = d3.scaleOrdinal()
        .domain(["Overall Project Summary", "BWB Door Types (Glazed & Metal)", "Windows and Openings", "Panjas and Interior Types", "Roller Shutters", "Common Specifications"])
        .range(["#FFD700", "#00FFFF", "#FF7F50", "#9370DB", "#FF69B4", "#90EE90"]); 
        // Gold, Cyan, Coral, Purple, HotPink, LightGreen

    // Function to determine color based on top-level parent
    function getNodeColor(d) {
        if (!d.parent) return "#FFFFFF"; // Root is white

        // Find the ancestor that is a direct child of root
        let ancestor = d;
        while (ancestor.parent && ancestor.parent.parent) {
            ancestor = ancestor.parent;
        }
        
        // Base color from the scale
        return colorScale(ancestor.data.name);
    }

    // Initialize root
    root = d3.hierarchy(treeData, function(d) { return d.children; });
    root.x0 = height / 2;
    root.y0 = 0;

    // Collapse after the second level to start tidy
    root.children.forEach(collapse);

    update(root);

    function collapse(d) {
        if(d.children) {
            d._children = d.children;
            d._children.forEach(collapse);
            d.children = null;
        }
    }

    function update(source) {
        // Assigns the x and y position for the nodes
        const treeData = treeMap(root);

        // Compute the new tree layout
        const nodes = treeData.descendants(),
              links = treeData.links();

        // Normalize for fixed-depth
        nodes.forEach(function(d){ d.y = d.depth * 280}); // Width between columns

        // ****************** Nodes section ******************

        const node = g.selectAll('g.node')
            .data(nodes, function(d) { return d.id || (d.id = ++i); });

        // Enter any new modes at the parent's previous position
        const nodeEnter = node.enter().append('g')
            .attr('class', 'node')
            .attr("transform", function(d) {
                return "translate(" + source.y0 + "," + source.x0 + ")";
            })
            .on('click', click);

        // Add Circle for the nodes
        nodeEnter.append('circle')
            .attr('class', 'node')
            .attr('r', 1e-6)
            .style("fill", function(d) {
                return d._children ? getNodeColor(d) : "#333"; // Solid if collapsed, dark if leaf
            })
            .style("stroke", function(d) { return getNodeColor(d); });

        // Add labels for the nodes
        nodeEnter.append('text')
            .attr("dy", ".35em")
            .attr("x", function(d) {
                return d.children || d._children ? -13 : 13;
            })
            .attr("text-anchor", function(d) {
                return d.children || d._children ? "end" : "start";
            })
            .text(function(d) { return d.data.name; });

        // UPDATE
        const nodeUpdate = nodeEnter.merge(node);

        // Transition to the proper position for the node
        nodeUpdate.transition()
            .duration(duration)
            .attr("transform", function(d) { 
                return "translate(" + d.y + "," + d.x + ")";
            });

        // Update the node attributes and style
        nodeUpdate.select('circle.node')
            .attr('r', 8)
            .style("fill", function(d) {
                // If has children hidden (_children), use color. If fully open or leaf, dark.
                return d._children ? getNodeColor(d) : "#2c3e50";
            })
            .style("stroke", function(d) { return getNodeColor(d); })
            .attr('cursor', 'pointer');


        // ****************** Links section ******************

        const link = g.selectAll('path.link')
            .data(links, function(d) { return d.target.id; });

        // Enter any new links at the parent's previous position
        const linkEnter = link.enter().insert('path', "g")
            .attr("class", "link")
            .style("stroke", function(d){ return getNodeColor(d.target); }) // Link inherits color from target
            .attr('d', function(d){
                const o = {x: source.x0, y: source.y0};
                return diagonal(o, o);
            });

        // UPDATE
        const linkUpdate = linkEnter.merge(link);

        // Transition back to the parent element position
        linkUpdate.transition()
            .duration(duration)
            .attr('d', function(d){ return diagonal(d, d.parent) });

        // EXIT
        // Remove any exiting nodes
        const nodeExit = node.exit().transition()
            .duration(duration)
            .attr("transform", function(d) {
                return "translate(" + source.y + "," + source.x + ")";
            })
            .remove();

        nodeExit.select('circle')
            .attr('r', 1e-6);

        nodeExit.select('text')
            .style('fill-opacity', 1e-6);

        // Remove any exiting links
        const linkExit = link.exit().transition()
            .duration(duration)
            .attr('d', function(d) {
                const o = {x: source.x, y: source.y};
                return diagonal(o, o);
            })
            .remove();

        // Store the old positions for transition
        nodes.forEach(function(d){
            d.x0 = d.x;
            d.y0 = d.y;
        });

        // Creates a curved (diagonal) path from parent to the child nodes
        function diagonal(s, d) {
            return `M ${s.y} ${s.x}
                    C ${(s.y + d.y) / 2} ${s.x},
                      ${(s.y + d.y) / 2} ${d.x},
                      ${d.y} ${d.x}`;
        }

        // Toggle children on click
        function click(event, d) {
            if (d.children) {
                d._children = d.children;
                d.children = null;
            } else {
                d.children = d._children;
                d._children = null;
            }
            update(d);
        }
    }

    // Auto-resize handler
    window.addEventListener('resize', () => {
        const newWidth = window.innerWidth - margin.left - margin.right;
        const newHeight = window.innerHeight - margin.top - margin.bottom;
        d3.select("svg").attr("width", window.innerWidth).attr("height", window.innerHeight);
    });

</script>

</body>
</html>